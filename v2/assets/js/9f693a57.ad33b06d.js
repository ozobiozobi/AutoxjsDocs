"use strict";(self.webpackChunkautox_doc=self.webpackChunkautox_doc||[]).push([[6597],{934:(r,e,n)=>{n.r(e),n.d(e,{assets:()=>s,contentTitle:()=>c,default:()=>u,frontMatter:()=>i,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"rhino/advanced/webViewAndHtml","title":"WebView \u4e0e HTML","description":"WebView.loadLocalFile(path)","source":"@site/docs/rhino/advanced/webViewAndHtml.md","sourceDirName":"rhino/advanced","slug":"/rhino/advanced/webViewAndHtml","permalink":"/docs/rhino/advanced/webViewAndHtml","draft":false,"unlisted":false,"editUrl":"https://github.com/aiselp/AutoxDoc/tree/main/docs/rhino/advanced/webViewAndHtml.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Threads \u591a\u7ebf\u7a0b","permalink":"/docs/rhino/advanced/threads"},"next":{"title":"Zips \u538b\u7f29\u4e0e\u89e3\u538b","permalink":"/docs/rhino/advanced/zips"}}');var a=n(4848),l=n(8453);const i={},c="WebView \u4e0e HTML",s={},o=[{value:"WebView.loadLocalFile(path)",id:"webviewloadlocalfilepath",level:2},{value:"JsBridge",id:"jsbridge",level:2},{value:"\u7eaf js \u5b9e\u73b0",id:"\u7eaf-js-\u5b9e\u73b0",level:2}];function d(r){const e={br:"br",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...r.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"webview-\u4e0e-html",children:"WebView \u4e0e HTML"})}),"\n",(0,a.jsx)(e.h2,{id:"webviewloadlocalfilepath",children:"WebView.loadLocalFile(path)"}),"\n",(0,a.jsx)(e.p,{children:"v7.1.3 \u65b0\u589e"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"path { string } \u6587\u4ef6\u6216\u76ee\u5f55\u6240\u5728\u7684\u7edd\u5bf9\u8def\u5f84"}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:"\u6b64\u65b9\u6cd5\u53ef\u4ee5\u4fbf\u6377\u7684\u52a0\u8f7d\u4e00\u4e2a\u672c\u5730 web \u9759\u6001\u7f51\u7ad9\uff0c\u8c03\u7528\u8be5\u65b9\u6cd5\u540e webview \u5c06\u53ef\u4ee5\u8bbf\u95ee path \u6240\u6307\u5b9a\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\uff0c\r\npath \u5982\u679c\u662f\u6587\u4ef6\u5c06\u83b7\u5f97\u8be5\u6587\u4ef6\u6240\u5728\u76ee\u5f55\u4e0b\u7684\u8bbf\u95ee\u6743\u9650"}),"\n",(0,a.jsxs)(e.p,{children:["\u9ed8\u8ba4\u60c5\u51b5\u4e0b WebView \u4e0d\u5177\u6709\u6587\u4ef6\u8bbf\u95ee\u6743\u9650\uff0c\u5982\u679c\u4f7f\u7528",(0,a.jsx)(e.code,{children:"WebView.settings.allowFileAccess = true"}),"\u5c06\u4f1a\u6388\u4e88\u6240\u6709\u6587\u4ef6\u7684\u8bbf\u95ee\u6743\uff0c\u8fd9\u6837\u5c06\u9762\u4e34\u4e00\u5b9a\u7684\u5b89\u5168\u98ce\u9669"]}),"\n",(0,a.jsx)(e.p,{children:"\u4f8b\u5b50"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-js",children:'"ui";\r\nui.layout(`\r\n    <vertical>\r\n        <webview id="web" h="*"/>\r\n    </vertical>`);\r\n//\u53ef\u7528files.path\u89e3\u6790\u76f8\u5bf9\u8def\u5f84\r\nui.web.loadLocalFile(files.path("./you/website"));\n'})}),"\n",(0,a.jsx)(e.h2,{id:"jsbridge",children:"JsBridge"}),"\n",(0,a.jsxs)(e.p,{children:["v6.3.9 \u65b0\u589e",(0,a.jsx)(e.br,{}),"\n","html>>"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-html",children:'<html>\r\n  <body style="font: size 2em">\r\n    <div style="font-size: 100px">\u539f\u5185\u5bb9</div>\r\n    \x3c!-- \u5bfc\u5165\u4f9d\u8d56\u5305\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u52a0\uff0c\u4e0d\u8fc7\u9700\u8981\u76d1\u542cAutoxJsBridgeReady\u4e8b\u4ef6\u540e\u624d\u80fd\u4f7f\u7528$autox --\x3e\r\n    <script src="autox://sdk.v1.js"><\/script>\r\n    <script>\r\n      function addText(text) {\r\n        const div = document.createElement("div");\r\n        div.innerHTML = text;\r\n        document.body.appendChild(div);\r\n      }\r\n      //\u6ce8\u518c\u4e00\u4e2a\u76d1\u542c\u51fd\u6570\r\n      $autox.registerHandler("jsTest", (data, callBack) => {\r\n        addText(`\u6765\u81ea\u5b89\u5353\u8c03\u7528\uff0cdata=${data}`);\r\n        setTimeout(() => {\r\n          //\u56de\u8c03\u5b89\u5353\r\n          callBack("web\u56de\u8c03\u6570\u636e");\r\n        }, 1000);\r\n      });\r\n      //\u8c03\u7528\u5b89\u5353\u7aef\r\n      $autox.callHandler("test", "web\u8c03\u7528\u6570\u636e", (data) => {\r\n        addText("\u5b89\u5353\u56de\u8c03, data:" + data);\r\n      });\r\n\r\n      document.addEventListener("AutoxJsBridgeReady", () => {\r\n        //$autox.\r\n      });\r\n    <\/script>\r\n  </body>\r\n</html>\n'})}),"\n",(0,a.jsx)(e.p,{children:"js \u4ee3\u7801"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-js",children:'"ui";\r\n\r\nui.layout(`\r\n    <vertical>\r\n        <webview id="web" h="*"/>\r\n    </vertical>`);\r\n//\u5141\u8bb8\u8bbf\u95ee\u6587\u4ef6\u8d44\u6e90\r\nui.web.settings.allowFileAccess = true;\r\nui.web.loadUrl("file://" + files.path("./\u7f51\u9875.html"));\r\n/*\r\n    \u6ce8\u610f\uff1a\u5728web\u4e0e\u5b89\u5353\u7aef\u4f20\u9012\u7684\u6570\u636e\u53ea\u80fd\u662f\u5b57\u7b26\u4e32\uff0c\u5176\u4ed6\u6570\u636e\u9700\u81ea\u884c\u4f7f\u7528JSON\u5e8f\u5217\u5316\r\n    \u5728\u8c03\u7528callHandler\u65f6\u4f20\u5165\u4e86\u56de\u8c03\u51fd\u6570\uff0c\u4f46web\u7aef\u6ca1\u6709\u8c03\u7528\u5219\u4f1a\u9020\u6210\u5185\u5b58\u6cc4\u9732\u3002\r\n    jsBridge\u81ea\u52a8\u6ce8\u5165\u4f9d\u8d56\u4e8ewebViewClient\uff0c\u5982\u8bbe\u7f6e\u4e86\u81ea\u5b9a\u4e49webViewClient\u5219\u9700\u8981\u5728\u5408\u9002\u7684\u65f6\u673a\uff08\u9875\u9762\u52a0\u8f7d\u5b8c\u6210\u540e\uff09\u8c03\u7528webview.injectionJsBridge()\u624b\u52a8\u6ce8\u5165\r\n*/\r\n//\u6ce8\u518c\u4e00\u4e2a\u76d1\u542c\u51fd\u6570\r\nui.web.jsBridge.registerHandler("test", (data, callBack) => {\r\n  toastLog("web\u8c03\u7528\u5b89\u5353,data:" + data);\r\n  setTimeout(() => {\r\n    //\u56de\u8c03web\r\n    callBack("1155");\r\n  }, 2000);\r\n});\r\n//\u5b9a\u65f6\u5668\u4e2d\u7b49\u5f85web\u52a0\u8f7d\u5b8c\u6210\r\nsetTimeout(() => {\r\n  ui.web.jsBridge.callHandler("jsTest", "\u6570\u636e", (data) => {\r\n    toastLog("web\u56de\u8c03,data:" + data);\r\n  });\r\n}, 1000);\n'})}),"\n",(0,a.jsx)(e.h2,{id:"\u7eaf-js-\u5b9e\u73b0",children:"\u7eaf js \u5b9e\u73b0"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-js",children:'"ui";\r\nui.layout(\r\n  <vertical>\r\n    <horizontal bg="#c7edcc" gravity="center" h="auto">\r\n      <button\r\n        text="\u7f51\u7edc\u51b2\u6d6a"\r\n        id="surfInternetBtn"\r\n        style="Widget.AppCompat.Button.Colored"\r\n        w="auto"\r\n      />\r\n      <button\r\n        text="\u8bb0\u5fc6\u7ffb\u724c"\r\n        id="loadLocalHtmlBtn"\r\n        style="Widget.AppCompat.Button.Colored"\r\n        w="auto"\r\n      />\r\n      <button\r\n        text="\u63a7\u5236\u53f0"\r\n        id="consoleBtn"\r\n        style="Widget.AppCompat.Button.Colored"\r\n        w="auto"\r\n      />\r\n    </horizontal>\r\n    <vertical h="*" w="*">\r\n      <webview id="webView" layout_below="title" w="*" h="*" />\r\n    </vertical>\r\n  </vertical>\r\n);\r\n\r\nfunction callJavaScript(webViewWidget, script, callback) {\r\n  try {\r\n    console.assert(webViewWidget != null, "webView\u63a7\u4ef6\u4e3a\u7a7a");\r\n    //console.log(script.toString())\r\n    webViewWidget.evaluateJavascript(\r\n      "javascript:" + script,\r\n      new JavaAdapter(android.webkit.ValueCallback, {\r\n        onReceiveValue: (val) => {\r\n          if (callback) {\r\n            callback(val);\r\n          }\r\n        },\r\n      })\r\n    );\r\n  } catch (e) {\r\n    console.error("\u6267\u884cJavaScript\u5931\u8d25");\r\n    console.trace(e);\r\n  }\r\n}\r\n\r\nfunction AutoX() {\r\n  let getAutoXFrame = () => {\r\n    let bridgeFrame = document.getElementById("AutoXFrame");\r\n    if (!bridgeFrame) {\r\n      bridgeFrame = document.createElement("iframe");\r\n      bridgeFrame.id = "AutoXFrame";\r\n      bridgeFrame.style = "display: none";\r\n      document.body.append(bridgeFrame);\r\n    }\r\n    return bridgeFrame;\r\n  };\r\n  const h5Callbackers = {};\r\n  let h5CallbackIndex = 1;\r\n  let setCallback = (callback) => {\r\n    let callId = h5CallbackIndex++;\r\n    h5Callbackers[callId] = {\r\n      callback: callback,\r\n    };\r\n    return callId;\r\n  };\r\n  let getCallback = (callId) => {\r\n    let callback = h5Callbackers[callId];\r\n    if (callback) {\r\n      delete h5Callbackers[callId];\r\n    }\r\n    return callback;\r\n  };\r\n\r\n  function invoke(cmd, params, callback) {\r\n    let callId = null;\r\n    try {\r\n      let paramsStr = JSON.stringify(params);\r\n      let AutoXFrame = getAutoXFrame();\r\n      callId = setCallback(callback);\r\n      AutoXFrame.src =\r\n        "jsbridge://" +\r\n        cmd +\r\n        "/" +\r\n        callId +\r\n        "/" +\r\n        encodeURIComponent(paramsStr);\r\n    } catch (e) {\r\n      if (callId) {\r\n        getCallback(callId);\r\n      }\r\n      console.trace(e);\r\n    }\r\n  }\r\n  let callback = (data) => {\r\n    let callId = data.callId;\r\n    let params = data.params;\r\n    let callbackFun = getCallback(callId);\r\n    if (callbackFun) {\r\n      callbackFun.callback(params);\r\n    }\r\n  };\r\n  return {\r\n    invoke: invoke,\r\n    callback: callback,\r\n  };\r\n}\r\nfunction bridgeHandler_handle(cmd, params) {\r\n  console.log(\r\n    "bridgeHandler\u5904\u7406 cmd=%s, params=%s",\r\n    cmd,\r\n    JSON.stringify(params)\r\n  );\r\n  let fun = this[cmd];\r\n  if (!fun) {\r\n    throw new Error("cmd= " + cmd + " \u6ca1\u6709\u5b9a\u4e49\u5b9e\u73b0");\r\n  }\r\n  let ret = fun(params);\r\n  return ret;\r\n}\r\nfunction mFunction(params) {\r\n  toastLog(params.toString());\r\n  device.vibrate(120);\r\n  return files.isDir("/storage/emulated/0/Download"); //\'toast\u63d0\u793a\u6210\u529f\';\r\n}\r\nfunction webViewExpand_init(webViewWidget) {\r\n  webViewWidget.webViewClient = new JavaAdapter(android.webkit.WebViewClient, {\r\n    onPageFinished: (webView, curUrl) => {\r\n      try {\r\n        // \u6ce8\u5165 AutoX\r\n        callJavaScript(\r\n          webView,\r\n          AutoX.toString() +\r\n            ";var auto0 = AutoX();auto0.invoke(\'mFunction\',\'This is AutoX!\',(data) => {console.log(\'\u63a5\u6536\u5230callback1:\' + JSON.stringify(data));});",\r\n          null\r\n        );\r\n      } catch (e) {\r\n        console.trace(e);\r\n      }\r\n    },\r\n    shouldOverrideUrlLoading: (webView, request) => {\r\n      let url = "";\r\n      try {\r\n        url = (request.a && request.a.a) || request.url;\r\n        if (url instanceof android.net.Uri) {\r\n          url = url.toString();\r\n        }\r\n        if (url.indexOf("jsbridge://") == 0) {\r\n          let uris = url.split("/");\r\n          let cmd = uris[2];\r\n          let callId = uris[3];\r\n          let params = java.net.URLDecoder.decode(uris[4], "UTF-8");\r\n          console.log(\r\n            "AutoX\u5904\u7406JavaScript\u8c03\u7528\u8bf7\u6c42: callId=%s, cmd=%s, params=%s",\r\n            callId,\r\n            cmd,\r\n            params\r\n          );\r\n          let result = null;\r\n          try {\r\n            result = bridgeHandler_handle(cmd, JSON.parse(params));\r\n          } catch (e) {\r\n            console.trace(e);\r\n            result = {\r\n              message: e.message,\r\n            };\r\n          }\r\n          result = result || {};\r\n          webView.loadUrl(\r\n            "javascript:auto0.callback({\'callId\':" +\r\n              callId +\r\n              ", \'params\': " +\r\n              JSON.stringify(result) +\r\n              "});"\r\n          );\r\n        } else if (\r\n          url.startsWith("http://") ||\r\n          url.startsWith("https://") ||\r\n          url.startsWith("file://") ||\r\n          url.startsWith("ws://") ||\r\n          url.startsWith("wss://")\r\n        ) {\r\n          webView.loadUrl(url);\r\n        } else {\r\n        }\r\n        return true;\r\n      } catch (e) {\r\n        if (\r\n          e.javaException instanceof android.content.ActivityNotFoundException\r\n        ) {\r\n          webView.loadUrl(url);\r\n        } else {\r\n          toastLog("\u65e0\u6cd5\u6253\u5f00URL: " + url);\r\n        }\r\n        console.trace(e);\r\n      }\r\n    },\r\n    onReceivedError: (webView, webResourceRequest, webResourceError) => {\r\n      let url = webResourceRequest.getUrl();\r\n      let errorCode = webResourceError.getErrorCode();\r\n      let description = webResourceError.getDescription();\r\n      console.trace(errorCode + " " + description + " " + url);\r\n    },\r\n  });\r\n  webViewWidget.webChromeClient = new JavaAdapter(\r\n    android.webkit.WebChromeClient,\r\n    {\r\n      onConsoleMessage: (msg) => {\r\n        console.log(\r\n          "[%s:%s]: %s",\r\n          msg.sourceId(),\r\n          msg.lineNumber(),\r\n          msg.message()\r\n        );\r\n      },\r\n    }\r\n  );\r\n}\r\nwebViewExpand_init(ui.webView);\r\nui.webView.loadUrl("https://wht.im");\r\n\r\nui.surfInternetBtn.on("click", () => {\r\n  webViewExpand_init(ui.webView);\r\n  ui.webView.loadUrl("https://wht.im");\r\n});\r\nui.consoleBtn.on("click", () => {\r\n  app.startActivity("console");\r\n});\r\nui.loadLocalHtmlBtn.on("click", () => {\r\n  webViewExpand_init(ui.webView);\r\n  let path = "file:" + files.path("game.html");\r\n  ui.webView.loadUrl(path);\r\n});\n'})})]})}function u(r={}){const{wrapper:e}={...(0,l.R)(),...r.components};return e?(0,a.jsx)(e,{...r,children:(0,a.jsx)(d,{...r})}):d(r)}},8453:(r,e,n)=>{n.d(e,{R:()=>i,x:()=>c});var t=n(6540);const a={},l=t.createContext(a);function i(r){const e=t.useContext(l);return t.useMemo((function(){return"function"==typeof r?r(e):{...e,...r}}),[e,r])}function c(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(a):r.components||a:i(r.components),t.createElement(l.Provider,{value:e},r.children)}}}]);